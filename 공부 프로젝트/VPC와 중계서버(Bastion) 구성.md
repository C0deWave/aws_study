## VPC와 중계서버 구성하기

### 목표: 가상의 네트워크에서 인터넷과 연결 또는 연결되어있지 않은 하위 네트워크를 만들고 다른 가상서버와 연결하기 위한 중계서버를 구성합니다.

---

### 실습 진행

![](https://raw.githubusercontent.com/C0deWave/aws_study/058cd62a4b5145f17373f9f46f5c53ef242bb9fb/이미지/VPC와%20중계서버(Bastion)%20구성2.png)

1. 검색창에 VPC를 눌러서 Amazon VPC로 이동
2. VPC생성 - 네임태그 입력 - CIDR값: 10.0.0.0/16 - 생성
3. 좌측의 서브넷으로 이동
4. 서브넷 생성 - VPC지정 - 서브넷 가용영역 지정 CIDR 블록: 10.0.1.0/24 - 생성
5. 위를 반복하여 2번째 퍼블릭 서브넷 생성
6. 위를 반복하여 4개의 private 서브넷 생성
7. 우측의 인터넷 게이트 웨이 클릭
8. 인터넷 게이트웨이 생성 클릭
9. 게이트웨이 선택후 VPC에 연결 클릭
10. 라우팅 테이블 클릭
11. 기존의 라우팅 테이블의 명칭 변경
12. 하단 메뉴에서 라우팅 클릭 - 라우팅 편집 클릭 - 추가 - 0.0.0.0/0 => 인터넷 게이트웨이로 연결
13. 라우팅을 타고 나갈 서브넷을 지정하기 위해서 서브넷 연결 클릭 - 서브넷 연결 편집 클릭 - 퍼블릭용 서브넷 1.0.1.0/24, 1.0.2.0/24 지정
14. 라우팅 테이블 생성 - VPC지정 - 서브넷 1.0.3.0/24 ~ 1.0.6.0/24 까지 지정
15. 좌측 NAT 게이트 웨이 클릭 - 생성 - 이름지정 - 서브넷: pub-2a 지정 - elastic ip 지정 - 생성
16. 같은 방식으로 pub-2c에 대한 nat 게이트웨이 생성
17. 라우팅 테이블로 와서 pri의 이름을 pri-2a로 변경 - 2a에 대한 서브넷만 지정(2개 제거)
18. 2c영역에 대한 라우팅 테이블 생성 => 가용 영역을 나누는 이유는 한쪽 영역에 장애가 났을때의 대처를 위함

---

### Bastion 인스턴스 만들기

Bastion서버는 Private에 있는 서버에 접속하는 역할을 하는 서버를 Bastion 서버라고 한다.

19. EC2에서 인스턴스 생성 - VPC 지정 - 서브넷: pub-2a로 지정 - public ip 자동지정 - 보안그룹 따로 지정후 22번 포트만 개방 - 보안을 위해서 Bastion용 키페어를 따로 생성후 지정

---

20. pri-2a 서브넷용 인스턴스 생성 - 키페어 및 보안 그룹 따로 생성
21. Bastion 서버 접속 후 서버 안에 pem키 복사
22. pri서버의 ssh연결을 했을때 나오는 명령어를 이용해서 Bastion 서버에서 Private Server로 접근
23. google.co.kr로 핑 -> 실패
24. 라우팅 테이블로 이동 - pri-2a 라우팅 테이블 접근 - 0.0.0.0/0 => NAT게이트웨이 2a 영역으로 지정
25. private server에서 인터넷 ping이 작동되는 것을 확인 할 수 있음

## 실습 결과

Bastion 서버에서 Private 서버로 접속후 NAT 설정을 하지 않았을때 인터넷이 막히다가 설정후 인터넷이 되는 상황

![](https://raw.githubusercontent.com/C0deWave/aws_study/ca68e91de43fcce7006f2684977737262762c88c/이미지/VPC와%20중계서버(Bastion)%20구성2.png)